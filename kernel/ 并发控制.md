# 自旋锁（spinlock）


https://www.cnblogs.com/ToTigerMountain/articles/17770206.html


禁用中断

```
spin_lock_init(lock);
spin_lock(lock);
...
spin_unlock(lock);
```


自旋锁和互斥体选用的3项原则。
1）当锁不能被获取到时，使用互斥体的开销是进程上下文切换时间，使用自旋锁的开销是等待获取自旋锁（由临界区执行时间决定）。若临界区比较小，宜使用自旋锁，若临界区很大，应使用互斥
体。
2）互斥体所保护的临界区可包含可能引起阻塞的代码，而自旋锁则绝对要避免用来保护包含这样代码的临界区。因为阻塞意味着要进行进程的切换，如果进程被切换出去后，另一个进程企图获取本自
旋锁，死锁就会发生。
3）互斥体存在于进程上下文，因此，如果被保护的共享资源需要在中断或软中断情况下使用，则在互斥体和自旋锁之间只能选择自旋锁。当然，如果一定要使用互斥体，则只能通过
mutex_trylock（）方式进行，不能获取就立即返回以避免阻塞。